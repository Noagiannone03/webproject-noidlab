<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>No id lab</title>
  <!-- Inclusion de GSAP et ScrollTrigger -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.11.5/gsap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.11.5/ScrollTrigger.min.js"></script>
  <!-- Inclusion de Three.js via CDN -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  <!-- Inclusion d'une police type bâton (ex : Montserrat) -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700&display=swap">
  <style>
    /* Réinitialisation et styles globaux */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    html, body {
      height: 100%;
    }
    body {
      font-family: 'Helvetica Neue', sans-serif;
      background: #fff;
      overflow-x: hidden;
      color: #333;
    }
    
    /* Canvas Three.js en arrière-plan */
    canvas#three-canvas {
      position: fixed;
      top: 0;
      left: 0;
      z-index: -1;
      width: 100%;
      height: 100%;
    }
    
    /* NAVBAR */
    .navbar {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 60px;
      background: #fff;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      pointer-events: none;
      z-index: 1000;
    }
    .navbar > div { pointer-events: auto; }
    .nav-center {
      position: absolute;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
      font-size: 24px;
      opacity: 0.5;
    }
    .nav-menu {
      position: absolute;
      right: 20px;
      top: 50%;
      transform: translateY(-50%);
      cursor: pointer;
    }
    .menu-icon {
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      width: 25px;
      height: 18px;
    }
    .menu-icon span {
      display: block;
      height: 3px;
      background: black;
      border-radius: 2px;
    }
    .nav-line {
      position: absolute;
      bottom: 0;
      left: 0;
      height: 3px;
      width: 0;
      background: black;
    }
    
    /* SECTION PRINCIPALE */
    #main {
      position: relative;
      height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
      background: transparent;
    }
    /* Bulles en fond */
    .bubble {
      position: absolute;
      border-radius: 50%;
      opacity: 0.05;
      background: radial-gradient(circle, rgba(0,0,0,0.1) 0%, rgba(0,0,0,0) 80%);
    }
    /* Titre principal avec effet de décryptage et sortie au scroll */
    #decrypt-title {
      position: relative;
      font-size: 6rem;
      letter-spacing: 0.1em;
      z-index: 2;
    }
    #decrypt-title span {
      display: inline-block;
    }
    
    /* SECTION "QUI SOMMES NOUS" existante */
    #about {
      padding: 150px 20px;
      background: transparent;
      text-align: center;
    }
    #about-title {
      font-size: 2.5rem;
      margin-bottom: 50px;
      overflow: hidden;
    }
    #about-title span {
      display: inline-block;
      transform: translateY(50px);
      opacity: 0;
    }
    .cards {
      display: flex;
      justify-content: center;
      gap: 40px;
      flex-wrap: wrap;
      padding: 0 20px;
    }
    .card {
      width: 320px;
      background: #fff;
      border-radius: 15px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.15);
      overflow: hidden;
      transform: translateY(50px);
      opacity: 0;
      transition: transform 0.3s, box-shadow 0.3s;
    }
    .card:hover {
      transform: translateY(-5px) scale(1.02);
      box-shadow: 0 15px 30px rgba(0,0,0,0.25);
    }
    .card img {
      width: 100%;
      display: block;
      height: 200px;
      object-fit: cover;
    }
    .card-content {
      padding: 20px;
      text-align: left;
    }
    
    /* NOUVELLE SECTION EMPILÉE */
    #stack-section {
      padding: 100px 20px;
      background: transparent;
      display: flex;
      flex-direction: column;
      gap: 40px;
      min-height: 100vh;
    }
    /* Les "cartes" de cette section n'ont pas de fond ou d'ombre */
    .stack-card {
      background: transparent;
      padding: 0;
      box-shadow: none;
      border-radius: 0;
    }
    /* Ligne 1 : Grand titre aligné à gauche */
    .stack-card.title {
      text-align: left;
      font-family: 'Montserrat', sans-serif;
      font-size: 3rem;
    }
    /* Ligne 2 : Sous-titre et bouton alignés à droite */
    .stack-card.subtitle {
      text-align: right;
    }
    .stack-card.subtitle h2 {
      font-family: 'Montserrat', sans-serif;
      font-size: 2rem;
      margin-bottom: 10px;
    }
    .stack-card.subtitle button {
      padding: 12px 24px;
      font-size: 1.1rem;
      border: none;
      background: #e0e0e0;
      border-radius: 12px;
      cursor: pointer;
      box-shadow: 6px 6px 12px #bebebe, -6px -6px 12px #ffffff;
      transition: all 0.2s;
    }
    .stack-card.subtitle button:active {
      box-shadow: inset 6px 6px 12px #bebebe, inset -6px -6px 12px #ffffff;
    }
    /* Ligne 3 : Carte image alignée à gauche */
    .stack-card.image {
      text-align: left;
      padding: 0;
      overflow: hidden;
    }
    .stack-card.image img {
      width: 100%;
      height: auto;
      display: block;
      border-radius: 15px;
    }
  </style>
</head>
<body>
  <!-- Le canvas Three.js sera injecté dynamiquement -->
  
  <!-- Navbar -->
  <nav class="navbar">
    <div class="nav-center">[ ]</div>
    <div class="nav-menu">
      <div class="menu-icon">
        <span></span>
        <span></span>
        <span></span>
      </div>
    </div>
    <div class="nav-line"></div>
  </nav>
  
  <!-- Section principale -->
  <section id="main">
    <!-- Titre principal avec effet de décryptage puis animation de sortie (scroll) -->
    <h1 id="decrypt-title">No id lab</h1>
    <!-- Bulles en fond -->
    <div class="bubble" style="width:100px; height:100px; top:10%; left:20%;"></div>
    <div class="bubble" style="width:80px; height:80px; top:70%; left:80%;"></div>
    <div class="bubble" style="width:120px; height:120px; top:40%; left:60%;"></div>
    <div class="bubble" style="width:60px; height:60px; top:80%; left:30%;"></div>
  </section>
  
  <!-- Section "Qui sommes nous" existante -->
  <section id="about">
    <h2 id="about-title">Qui sommes nous</h2>
    <div class="cards">
      <div class="card">
        <img src="https://via.placeholder.com/320x200" alt="Image 1" />
        <div class="card-content">
          <h3>Titre 1</h3>
          <p>Description élégante de la première carte, présentant des idées innovantes.</p>
        </div>
      </div>
      <div class="card">
        <img src="https://via.placeholder.com/320x200" alt="Image 2" />
        <div class="card-content">
          <h3>Titre 2</h3>
          <p>Description élégante de la deuxième carte, illustrant des concepts modernes.</p>
        </div>
      </div>
      <div class="card">
        <img src="https://via.placeholder.com/320x200" alt="Image 3" />
        <div class="card-content">
          <h3>Titre 3</h3>
          <p>Description de la troisième carte pour enrichir la présentation.</p>
        </div>
      </div>
    </div>
  </section>
  
  <!-- Nouvelle section empilée -->
  <section id="stack-section">
    <!-- Ligne 1 : Grand titre aligné à gauche -->
    <div class="stack-card title">
      <h1>Titre Principal</h1>
    </div>
    <!-- Ligne 2 : Sous-titre et bouton alignés à droite -->
    <div class="stack-card subtitle">
      <h2>Sous-titre</h2>
      <button>Action</button>
    </div>
    <!-- Ligne 3 : Carte image alignée à gauche -->
    <div class="stack-card image">
      <img src="https://via.placeholder.com/600x400" alt="Image de présentation" />
    </div>
  </section>
  
  <!-- Script Three.js pour le tracé progressif -->
  <script>
    // Création du renderer, de la scène et de la caméra
    const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: false });
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.domElement.id = 'three-canvas';
    document.body.appendChild(renderer.domElement);

    const scene = new THREE.Scene();
    scene.background = new THREE.Color(0xffffff);

    const camera = new THREE.PerspectiveCamera(
      50,
      window.innerWidth / window.innerHeight,
      0.1,
      1000
    );
    // Position initiale de la caméra
    camera.position.set(0, 0, 30);

    // Création d'une courbe pour tracer un tube (le "trait")
    const curve = new THREE.CatmullRomCurve3([
      new THREE.Vector3(-30, 0, 0),
      new THREE.Vector3(-5, 8, 0),
      new THREE.Vector3(0, -8, 0),
      new THREE.Vector3(8, 5, 0),
      new THREE.Vector3(15, 0, 0)
    ]);
    const tubularSegments = 30000;
    const radius = 0.6;
    const radialSegments = 20;
    const closed = false;
    
    const tubeGeometry = new THREE.TubeGeometry(curve, tubularSegments, radius, radialSegments, closed);
    // Au départ, aucun segment n'est affiché
    tubeGeometry.setDrawRange(0, 0);
    
    const tubeMaterial = new THREE.MeshPhysicalMaterial({
      color: 0x000000,
      metalness: 0.1,
      roughness: 0.5,
      clearcoat: 0.2,
      clearcoatRoughness: 0.1,
      flatShading: true
    });
    const tubeMesh = new THREE.Mesh(tubeGeometry, tubeMaterial);
    scene.add(tubeMesh);
    
    const totalIndices = tubeGeometry.index.count;
    
    window.addEventListener('resize', () => {
      renderer.setSize(window.innerWidth, window.innerHeight);
      camera.aspect = window.innerWidth / window.innerHeight;
      camera.updateProjectionMatrix();
    });
    
    function animateScene() {
      requestAnimationFrame(animateScene);
      renderer.render(scene, camera);
    }
    animateScene();
    
    // Révélation progressive du tube en fonction du scroll
    window.addEventListener('scroll', () => {
      const scrollY = window.scrollY;
      const scrollable = document.body.scrollHeight - window.innerHeight;
      const scrollRatio = scrollY / scrollable;
      const newCount = Math.floor(totalIndices * scrollRatio);
      tubeGeometry.setDrawRange(0, newCount);
    });
    
    // Animation de la caméra : la caméra descend plus vite qu'avant (de 0 à -15)
    gsap.to(camera.position, {
      y: -15,
      ease: "none",
      scrollTrigger: {
        trigger: "body",
        start: "top top",
        end: "bottom bottom",
        scrub: true
      }
    });
    
    // Animation du tube pour qu'il "descende" en synchronisation (ou presque) avec la caméra
    gsap.to(tubeMesh.position, {
      y: -20,
      ease: "none",
      scrollTrigger: {
        trigger: "body",
        start: "top top",
        end: "bottom bottom",
        scrub: true
      }
    });
  </script>
  
  <!-- Script GSAP pour les animations de la page -->
  <script>
    document.addEventListener("DOMContentLoaded", function() {
      /* --- Animation du titre principal (effet décryptage initial puis sortie au scroll) --- */
      const title = document.getElementById('decrypt-title');
      const finalText = title.textContent;
      title.textContent = '';
      // Encapsulation de chaque lettre dans un span pour animation individuelle
      finalText.split('').forEach(letter => {
        const span = document.createElement('span');
        span.textContent = letter;
        title.appendChild(span);
      });
      
      // Effet décryptage initial (4 secondes)
      let iterations = 0;
      const chars = '!<>-_\\/[]{}—=+*^?#________';
      const totalIterations = finalText.length * 3;
      const interval = 4000 / totalIterations;
      const timer = setInterval(() => {
        title.querySelectorAll('span').forEach((span, index) => {
          if(index < iterations) {
            span.textContent = finalText[index];
          } else {
            span.textContent = chars[Math.floor(Math.random() * chars.length)];
          }
        });
        iterations++;
        if(iterations > finalText.length) {
          clearInterval(timer);
          title.textContent = finalText;
          // On réencapsule pour l'animation de scroll
          title.innerHTML = '';
          finalText.split('').forEach(letter => {
            const span = document.createElement('span');
            span.textContent = letter;
            title.appendChild(span);
          });
        }
      }, interval);
      
      // Animation scroll : chaque lettre du titre se déplace vers le haut et disparaît
      gsap.to("#decrypt-title span", {
        y: -50,
        opacity: 0,
        ease: "none",
        scrollTrigger: {
          trigger: "#main",
          start: "top top",
          end: "bottom top",
          scrub: true
        }
      });
      
      // Animation de la barre de la navbar
      gsap.to(".nav-line", {
        width: "100%",
        boxShadow: "0 0 20px rgba(0,0,0,0.5)",
        duration: 1,
        ease: "power2.out",
        scrollTrigger: {
          trigger: "body",
          start: "top top",
          end: "top+=100",
          toggleActions: "play none none reverse"
        }
      });
      
      // Animation des bulles en fond
      gsap.utils.toArray(".bubble").forEach(bubble => {
        gsap.to(bubble, {
          x: "random(-50, 50)",
          y: "random(-50, 50)",
          duration: "random(20, 40)",
          repeat: -1,
          yoyo: true,
          ease: "sine.inOut"
        });
      });
      
      // Animation du titre "Qui sommes nous" : apparition lettre par lettre
      const aboutTitle = document.getElementById('about-title');
      const text = aboutTitle.textContent;
      aboutTitle.textContent = '';
      text.split('').forEach(letter => {
        const span = document.createElement('span');
        span.textContent = letter;
        aboutTitle.appendChild(span);
      });
      gsap.to("#about-title span", {
        y: 0,
        opacity: 1,
        duration: 0.8,
        ease: "power2.out",
        stagger: 0.05,
        scrollTrigger: {
          trigger: "#about",
          start: "top 80%"
        }
      });
      
      // Animation des cartes de la section "Qui sommes nous"
      gsap.to(".card", {
        y: 0,
        opacity: 1,
        duration: 1,
        ease: "power2.out",
        stagger: 0.3,
        scrollTrigger: {
          trigger: ".cards",
          start: "top 80%"
        }
      });
    });
  </script>
</body>
</html>
